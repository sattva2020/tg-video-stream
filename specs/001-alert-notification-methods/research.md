# Research Findings

## Decisions

- **Decision**: Используем `apprise` как универсальный адаптер + точечные SDK (aiosmtplib, aiogram, httpx, slack_sdk, twilio) для критичных каналов.
  - **Rationale**: Apprise покрывает 80+ каналов и ускоряет поддержку вебхуков/мессенджеров; точечные SDK дают контроль/трассировку для основных каналов (email/Telegram/Slack/SMS).
  - **Alternatives considered**: Чисто SDK для каждого канала — больше кода/дублирование паттернов; собственные плагины без Apprise — выше стоимость расширения.

- **Decision**: Надёжность по умолчанию — 3 попытки с интервалом 30s, таймаут отправки 10s HTTP / 15s SMTP, failover через резервный канал по таймауту, тестовая отправка таймаут 65s (как в Zabbix).
  - **Rationale**: Соответствует ожиданиям Zabbix-подобного UX; даёт баланс между скоростью и повторными попытками.
  - **Alternatives considered**: Немедленные повторы без интервала — риск дублирования/нагрузки; больше 3 попыток — рост задержек без значимого выигрыша.

- **Decision**: Цель производительности p95 доставки (event → success/failover лог) ≤30s при рабочем канале; очередь Celery с параллелизмом по каналу (default 5) и backpressure через Redis.
  - **Rationale**: Соответствует success criteria SC-002 и укладывается в типичные SLA алертинга.
  - **Alternatives considered**: Синхронная отправка в API — блокирует запросы и ухудшает UX; без backpressure — риск переполнения.

- **Decision**: Масштаб по умолчанию — до 10k событий/день, ≤200 правил, ≤1k получателей; дедуп/ratelimit через Redis TTL-ключи.
  - **Rationale**: Реалистичный стартовый профиль; позволяет выбрать параметры TTL и шардирования очередей.
  - **Alternatives considered**: Игнорировать масштаб — сложно подобрать лимиты; сразу закладывать 100k+/день — преждевременная сложность.

- **Decision**: Хранение каналов/шаблонов/правил/журналов в PostgreSQL; дедуп и rate-limit окна — в Redis; все операции логируются (DeliveryLog) с latency/кодом ответа.
  - **Rationale**: Postgres для консистентных настроек и аудита; Redis для быстрых окон и счётчиков.
  - **Alternatives considered**: Только Postgres — медленные окна; только Redis — потеря устойчивости и истории.
