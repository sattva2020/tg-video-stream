# Feature Specification: Auth Page Design

**Feature Branch**: `008-auth-page-design`
**Created**: 2025-11-23
**Status**: Draft
**Input**: User description: "Дизайн страницы регистрации/входа должен соответствовать тематике нашего проекта"

> ⚖️ Конституция: все текстовые блоки заполняем на русском. Каждая пользовательская история
> должна быть независимой, иметь измеримые критерии успеха и ссылаться на будущие тесты и
> документацию, иначе `/speckit.plan` не пройдет гейт.

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Consistent Visual Theme (Priority: P1)

Как пользователь, я хочу видеть страницу входа/регистрации, оформленную в едином стиле с остальным проектом (ZenScene, системные шрифты), чтобы чувствовать целостность интерфейса.

**Why this priority**: Визуальная целостность важна для доверия пользователя и профессионального восприятия продукта. Текущий дизайн использует шрифты (Lato), отличные от системных (LandingSans), и может иметь несоответствия в цветовой палитре.

**Independent Test**: Открыть страницу авторизации и сравнить её стилистику (фон, шрифты, отступы) с Лендингом. Они должны визуально сочетаться.

**Acceptance Scenarios**:

1. **Given** пользователь открывает страницу авторизации, **When** страница загружается, **Then** отображается фон ZenScene и используются шрифты `LandingSans` (для основного текста) и `LandingSerif` (для заголовков), определенные в `index.css`.
2. **Given** пользователь находится на странице авторизации, **When** он взаимодействует с формой, **Then** элементы формы (кнопки, инпуты) используют цвета `ink` и `parchment` из темы, а не случайные оттенки серого/белого.

---

### User Story 2 - Responsive Design (Priority: P2)

Как пользователь мобильного устройства, я хочу, чтобы страница авторизации корректно отображалась на моем экране, чтобы я мог удобно ввести данные.

**Why this priority**: Значительная часть пользователей может заходить с мобильных устройств (Telegram mobile).

**Independent Test**: Открыть страницу в режиме эмуляции мобильного устройства (320px) и проверить доступность всех элементов.

**Acceptance Scenarios**:

1. **Given** пользователь открывает страницу на устройстве с шириной экрана 320px, **When** страница загружается, **Then** горизонтальный скролл отсутствует, все поля ввода и кнопки доступны и имеют достаточный размер для нажатия.

---

### User Story 3 - Error Message Styling (Priority: P3)

Как пользователь, я хочу, чтобы сообщения об ошибках (например, "Email already registered") отображались читаемо и в стиле проекта, чтобы я мог легко понять проблему.

**Why this priority**: Мы недавно внедрили локализацию ошибок, теперь нужно убедиться, что они выглядят красиво и вписываются в дизайн.

**Independent Test**: Вызвать ошибку (например, ввести существующий email) и проверить стиль уведомления.

**Acceptance Scenarios**:

1. **Given** пользователь вводит существующий email, **When** сервер возвращает ошибку 409, **Then** появляется сообщение об ошибке, оформленное в стиле проекта (цвет, шрифт, иконка), и текст соответствует выбранному языку.

---

### User Story 4 - Dual Theme & Dashboard Greeting (Priority: P1)

Как одобренный пользователь (admin или user), я хочу переключать светлую/тёмную тему на странице авторизации и сразу видеть, что dashboard приветственный блок использует тот же стиль, чтобы интерфейс выглядел единым.

**Why this priority**: Dashboard — ключевой экран после авторизации. Несогласованность тем создаёт визуальный шум и нарушает бренд. Переключатель тем и сохранение выбора — требование стейкхолдеров.

**Independent Test**: Включить Playwright сценарий «theme toggle», переключить тему и убедиться, что и auth form, и dashboard HeroPanel обновляют фон/шрифты <200 мс, а выбор сохраняется в `localStorage`.

**Acceptance Scenarios**:

1. **Given** пользователь открывает страницу авторизации впервые, **When** не задана тема, **Then** приложение автоматически выбирает тему согласно `prefers-color-scheme` и отображает соответствующий фон/типографику.
2. **Given** пользователь кликает на переключатель темы и выбирает «Тёмная», **When** страница авторизации и dashboard грузятся, **Then** обе части интерфейса применяют ночную палитру (`colorNightSky`, `colorInkDark`) и шрифты LandingSans/Serif без перезагрузки страницы.
3. **Given** пользователь возвращается позже, **When** страница авторизации открывается снова, **Then** применяется сохранённая ранее тема вне зависимости от системной темы.

### Edge Cases

- **EC-001**: **WebGL Not Supported**: Если браузер пользователя не поддерживает WebGL (необходимый для 3D сцены), должен отображаться статический фон (паттерн ZenScene), чтобы интерфейс оставался доступным.
- **EC-002**: **Slow Connection**: При медленной загрузке 3D-сцены контент формы должен быть доступен и функционален немедленно, не блокируясь загрузкой фона.
- **EC-003**: **Very Small Screens**: На экранах меньше 320px контент должен масштабироваться или перестраиваться, но оставаться читаемым (без обрезания).
- **EC-004**: **Theme Persistence Conflict**: Если сохранённая тема противоречит текущему `prefers-color-scheme`, интерфейс должен показать последнюю явную настройку пользователя и предложить вернуться к системной теме через подсказку.

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: Страница авторизации ДОЛЖНА использовать типографику проекта (шрифты с засечками для заголовков, без засечек для основного текста), соответствующую Лендингу.
- **FR-002**: Цветовая схема страницы ДОЛЖНА соответствовать теме "Чернила на пергаменте" (светлый теплый фон, темный контрастный текст), обеспечивая читаемость.
- **FR-003**: Элементы интерфейса (кнопки, поля ввода) ДОЛЖНЫ иметь стиль, визуально согласованный с компонентами Лендинга (скругления, обводки, состояния наведения).
- **FR-004**: Верстка страницы ДОЛЖНА быть адаптивной и корректно отображаться на мобильных устройствах (от 320px).
- **FR-005**: В случае ошибки загрузки 3D-фона, ДОЛЖЕН отображаться запасной статический фон в стиле проекта.
- **FR-006**: Интерфейс ДОЛЖЕН предоставлять переключатель светлая/тёмная тема, использовать `prefers-color-scheme` по умолчанию и сохранять выбор пользователя между сессиями.
- **FR-007**: Приветственный блок dashboard (HeroPanel) ДОЛЖЕН наследовать выбранную тему, шрифты и токены цвета со страницы авторизации.
- **FR-008**: API-ответы `/api/auth/login|register` и `/api/users/me` ДОЛЖНЫ возвращать структурированные поля для ошибок статусов 403/409: обязательные `code` и `hint`, и одну из двух форм представления текста ошибки:

	- `message` — строка с уже локализованным текстом ошибки, возвращается сервером ТОЛЬКО когда сервер поддерживает локализацию клиентского языка (Accept-Language) и реально сгенерировал перевод для запрошенного языка. Если сервер возвращает `message`, фронтенд должен отобразить его напрямую (без повторной локализации).

	- `message_key` — ключ локализации (строка в формате `namespace.key`, например `auth.email_registered`), возвращаемый сервером если он не локализовал текст для клиентского языка. Фронтенд должен разрешить `message_key` с помощью i18next и показать значение на языке клиента.

	Требования к поведению и fallback:

	1. Клиент может отправлять заголовок `Accept-Language`. Если сервер поддерживает локализацию для указанного языка и имеет перевод — он ДОЛЖЕН вернуть `message`. Сервер МОЖЕТ одновременно возвращать `message_key` для отладки, но `message` имеет приоритет.
	2. Если сервер не поддерживает локализацию запрошенного языка или не имеет перевода — он ДОЛЖЕН вернуть `message_key` (и НЕ обязан возвращать `message`).
	3. В любом случае поля `code` и `hint` обязательны и используются приложением для логики и подсказок (hint — action hint, техническая подсказка). `hint` НЕ предназначен для display/UX-локализации, это внутренняя подсказка для инженеров и тестов.
	4. Формат `message_key` — точечная нотация, ASCII lower-case, цифры, `_` и `.` разрешены. Примеры: `auth.email_registered`, `auth.account_pending`.

	Acceptance tests для FR-008 (обязательны до слияния):

	- Pytest: покрытие контрактного поведения: (a) запросы с `Accept-Language: ru` если сервер локализует — возвращается `message` (и `code`/`hint` присутствуют); (b) при отсутствии локализации возвращается `message_key` и `code`/`hint`.
	- Playwright/E2E: два сценария — stub сервера возвращает `message` (готовая русская строка) → UI показывает текст как есть; stub сервера возвращает `message_key` → UI резолвит ключ через i18next и показывает перевод (ru).
	- Vitest/unit: компонент `ErrorToast` должен корректно отображать оба варианта и иметь тесты для отображения `message` и `message_key`.

	Документировать и синхронизировать эти правила с `specs/008-auth-page-design/contracts/auth-ui.yaml` и задачами (T023a, T024, T025, T026).

### Key Entities *(include if feature involves data)*

- **User**: Пользователь, взаимодействующий с формой.

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: Визуальное соответствие страницы авторизации и Лендинга подтверждено (шрифты, цвета, отступы совпадают). Методы проверки: автоматические Vitest снапшоты (компоненты) и Playwright визуальные проверки ключевых блоков (AuthCard, HeroPanel, CTA) с допустимым пиксельным отклонением ±2 px для основных метрик.
- **SC-002**: Lighthouse Accessibility score для страницы авторизации > 90.
- **SC-003**: Время до взаимодействия (TTI) на мобильных устройствах < 2 секунд (не блокируется загрузкой 3D).
- **SC-004**: Отсутствие горизонтального скролла и наложений элементов на ширине экрана 320px.
- **SC-005**: Переключение темы выполняется < 200 мс, состояние сохраняется в localStorage и синхронизируется с dashboard без перезагрузки.
- **SC-006**: Приветственный блок dashboard визуально консистентен со страницей авторизации (скриншоты сравнения показывают совпадение палитры/типографики, допуска ±2 px).

### Localization & Supported Languages

- Для старта поддерживаем два языка: `ru` и `en`. Для демонстрации и тестирования основной язык — `ru`. Поведение сервера/клиента по `message` / `message_key` описано в FR-008; клиент обязан резолвить `message_key` через i18next.

