# Feature Specification: Auth Page Design

**Feature Branch**: `008-auth-page-design`
**Created**: 2025-11-23
**Status**: Draft
**Input**: User description: "Дизайн страницы регистрации/входа должен соответствовать тематике нашего проекта"

> ⚖️ Конституция: все текстовые блоки заполняем на русском. Каждая пользовательская история
> должна быть независимой, иметь измеримые критерии успеха и ссылаться на будущие тесты и
> документацию, иначе `/speckit.plan` не пройдет гейт.

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Consistent Visual Theme (Priority: P1)

Как пользователь, я хочу видеть страницу входа/регистрации, оформленную в едином стиле с остальным проектом (ZenScene, системные шрифты), чтобы чувствовать целостность интерфейса.

**Why this priority**: Визуальная целостность важна для доверия пользователя и профессионального восприятия продукта. Текущий дизайн использует шрифты (Lato), отличные от системных (LandingSans), и может иметь несоответствия в цветовой палитре.

**Independent Test**: Открыть страницу авторизации и сравнить её стилистику (фон, шрифты, отступы) с Лендингом. Они должны визуально сочетаться.

**Acceptance Scenarios**:

1. **Given** пользователь открывает страницу авторизации, **When** страница загружается, **Then** отображается фон ZenScene и используются шрифты `LandingSans` (для основного текста) и `LandingSerif` (для заголовков), определенные в `index.css`.
2. **Given** пользователь находится на странице авторизации, **When** он взаимодействует с формой, **Then** элементы формы (кнопки, инпуты) используют цвета `ink` и `parchment` из темы, а не случайные оттенки серого/белого.

---

### User Story 2 - Responsive Design (Priority: P2)

Как пользователь мобильного устройства, я хочу, чтобы страница авторизации корректно отображалась на моем экране, чтобы я мог удобно ввести данные.

**Why this priority**: Значительная часть пользователей может заходить с мобильных устройств (Telegram mobile).

**Independent Test**: Открыть страницу в режиме эмуляции мобильного устройства (320px) и проверить доступность всех элементов.

**Acceptance Scenarios**:

1. **Given** пользователь открывает страницу на устройстве с шириной экрана 320px, **When** страница загружается, **Then** горизонтальный скролл отсутствует, все поля ввода и кнопки доступны и имеют достаточный размер для нажатия.

---

### User Story 3 - Error Message Styling (Priority: P3)

Как пользователь, я хочу, чтобы сообщения об ошибках (например, "Email already registered") отображались читаемо и в стиле проекта, чтобы я мог легко понять проблему.

**Why this priority**: Мы недавно внедрили локализацию ошибок, теперь нужно убедиться, что они выглядят красиво и вписываются в дизайн.

**Independent Test**: Вызвать ошибку (например, ввести существующий email) и проверить стиль уведомления.

**Acceptance Scenarios**:

1. **Given** пользователь вводит существующий email, **When** сервер возвращает ошибку 409, **Then** появляется сообщение об ошибке, оформленное в стиле проекта (цвет, шрифт, иконка), и текст соответствует выбранному языку.

---

### User Story 4 - Dual Theme & Dashboard Greeting (Priority: P1)

Как одобренный пользователь (admin или user), я хочу переключать светлую/тёмную тему на странице авторизации и сразу видеть, что dashboard приветственный блок использует тот же стиль, чтобы интерфейс выглядел единым.

**Why this priority**: Dashboard — ключевой экран после авторизации. Несогласованность тем создаёт визуальный шум и нарушает бренд. Переключатель тем и сохранение выбора — требование стейкхолдеров.

**Independent Test**: Включить Playwright сценарий «theme toggle», переключить тему и убедиться, что и auth form, и dashboard HeroPanel обновляют фон/шрифты <200 мс, а выбор сохраняется в `localStorage`.

**Acceptance Scenarios**:

1. **Given** пользователь открывает страницу авторизации впервые, **When** не задана тема, **Then** приложение автоматически выбирает тему согласно `prefers-color-scheme` и отображает соответствующий фон/типографику.
2. **Given** пользователь кликает на переключатель темы и выбирает «Тёмная», **When** страница авторизации и dashboard грузятся, **Then** обе части интерфейса применяют ночную палитру (`colorNightSky`, `colorInkDark`) и шрифты LandingSans/Serif без перезагрузки страницы.
3. **Given** пользователь возвращается позже, **When** страница авторизации открывается снова, **Then** применяется сохранённая ранее тема вне зависимости от системной темы.

### Edge Cases

- **EC-001**: **WebGL Not Supported**: Если браузер пользователя не поддерживает WebGL (необходимый для 3D сцены), должен отображаться статический фон (паттерн ZenScene), чтобы интерфейс оставался доступным.
- **EC-002**: **Slow Connection**: При медленной загрузке 3D-сцены контент формы должен быть доступен и функционален немедленно, не блокируясь загрузкой фона.
- **EC-003**: **Very Small Screens**: На экранах меньше 320px контент должен масштабироваться или перестраиваться, но оставаться читаемым (без обрезания).
- **EC-004**: **Theme Persistence Conflict**: Если сохранённая тема противоречит текущему `prefers-color-scheme`, интерфейс должен показать последнюю явную настройку пользователя и предложить вернуться к системной теме через подсказку.

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: Страница авторизации ДОЛЖНА использовать типографику проекта (шрифты с засечками для заголовков, без засечек для основного текста), соответствующую Лендингу.
- **FR-002**: Цветовая схема страницы ДОЛЖНА соответствовать теме "Чернила на пергаменте" (светлый теплый фон, темный контрастный текст), обеспечивая читаемость.
- **FR-003**: Элементы интерфейса (кнопки, поля ввода) ДОЛЖНЫ иметь стиль, визуально согласованный с компонентами Лендинга (скругления, обводки, состояния наведения).
- **FR-004**: Верстка страницы ДОЛЖНА быть адаптивной и корректно отображаться на мобильных устройствах (от 320px).
- **FR-005**: В случае ошибки загрузки 3D-фона, ДОЛЖЕН отображаться запасной статический фон в стиле проекта.
- **FR-006**: Интерфейс ДОЛЖЕН предоставлять переключатель светлая/тёмная тема, использовать `prefers-color-scheme` по умолчанию и сохранять выбор пользователя между сессиями.
- **FR-007**: Приветственный блок dashboard (HeroPanel) ДОЛЖЕН наследовать выбранную тему, шрифты и токены цвета со страницы авторизации.
- **FR-008**: API-ответы `/api/auth/login|register` и `/api/users/me` ДОЛЖНЫ возвращать структурированные поля для ошибок статусов 403/409: обязательные `code` и `hint`, а также либо локализованный `message` (если сервер поддерживает `Accept-Language`), либо `message_key` (ключ локализации), чтобы UI мог формировать локализованные Alert/Toast с помощью i18next.

### Key Entities *(include if feature involves data)*

- **User**: Пользователь, взаимодействующий с формой.

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: Визуальное соответствие страницы авторизации и Лендинга подтверждено (шрифты, цвета, отступы совпадают).
- **SC-002**: Lighthouse Accessibility score для страницы авторизации > 90.
- **SC-003**: Время до взаимодействия (TTI) на мобильных устройствах < 2 секунд (не блокируется загрузкой 3D).
- **SC-004**: Отсутствие горизонтального скролла и наложений элементов на ширине экрана 320px.
- **SC-005**: Переключение темы выполняется < 200 мс, состояние сохраняется в localStorage и синхронизируется с dashboard без перезагрузки.
- **SC-006**: Приветственный блок dashboard визуально консистентен со страницей авторизации (скриншоты сравнения показывают совпадение палитры/типографики, допуска ±2 px).

