# –°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª–∏–º–∏—Ç–æ–≤ Telegram API

## –û–±–∑–æ—Ä

Telegram API –∏–º–µ–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤. –≠—Ç–æ—Ç –º–æ–¥—É–ª—å –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –ª–∏–º–∏—Ç–∞
- –•—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ª–∏–º–∏—Ç–∞—Ö –≤ Redis
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–Ω—è—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –¢–∞–π–º–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á—ë—Ç–∞ –¥–æ —Å–Ω—è—Ç–∏—è –ª–∏–º–∏—Ç–∞

## –¢–∏–ø—ã –ª–∏–º–∏—Ç–æ–≤

| –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è |
|-----|----------|----------------|
| `flood_wait` | –û–±—â–∏–π –ª–∏–º–∏—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã | –£–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –æ—Ç–≤–µ—Ç–µ API |
| `phone_number_flood` | –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å –Ω–æ–º–µ—Ä–∞ | ~1 —á–∞—Å |
| `phone_code_expired` | –ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏—Å—Ç—ë–∫ | 0 (–∑–∞–ø—Ä–æ—Å–∏—Ç—å –Ω–æ–≤—ã–π) |
| `send_code_unavailable` | –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ | ~30 –º–∏–Ω—É—Ç |
| `peer_flood` | –õ–∏–º–∏—Ç –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏/–∫–∞–Ω–∞–ª–∞–º–∏ | ~24 —á–∞—Å–∞ |
| `password_flood` | –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫ –ø–∞—Ä–æ–ª—è 2FA | ~10 –º–∏–Ω—É—Ç |
| `phone_banned` | –ù–æ–º–µ—Ä –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –≤ Telegram | –ë–µ—Å—Å—Ä–æ—á–Ω–æ |
| `api_id_flood` | –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç API_ID | ~24 —á–∞—Å–∞ |

## API Endpoints

### GET `/api/auth/telegram/limit-status/{phone}`
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ª–∏–º–∏—Ç–∞ –¥–ª—è –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞.

**–û—Ç–≤–µ—Ç (–µ—Å–ª–∏ –ª–∏–º–∏—Ç –∞–∫—Ç–∏–≤–µ–Ω):**
```json
{
  "limited": true,
  "type": "phone_number_flood",
  "message": "üìµ –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å —ç—Ç–æ–≥–æ –Ω–æ–º–µ—Ä–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ 45 –º–∏–Ω.",
  "remaining_seconds": 2700,
  "retry_after": "2025-12-01T14:00:00"
}
```

**–û—Ç–≤–µ—Ç (–µ—Å–ª–∏ –ª–∏–º–∏—Ç–∞ –Ω–µ—Ç):**
```json
{
  "limited": false
}
```

### GET `/api/auth/telegram/limit-stats`
–ü–æ–ª—É—á–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ª–∏–º–∏—Ç–æ–≤ (–¥–ª—è –∞–¥–º–∏–Ω–æ–≤).

**–û—Ç–≤–µ—Ç:**
```json
{
  "api_id_limited": false,
  "active_phone_limits": 3,
  "stats_24h": {
    "flood_wait": 5,
    "phone_number_flood": 2
  },
  "status": "ok"
}
```

## –û—Ç–≤–µ—Ç –ø—Ä–∏ –ª–∏–º–∏—Ç–µ (HTTP 429)

–ö–æ–≥–¥–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ª–∏–º–∏—Ç, API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç HTTP 429 —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π:

```json
{
  "error": "rate_limit",
  "type": "phone_number_flood",
  "message": "üìµ –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å —ç—Ç–æ–≥–æ –Ω–æ–º–µ—Ä–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ 1 —á.",
  "wait_seconds": 3600,
  "remaining_seconds": 3542,
  "retry_after": "2025-12-01T14:00:00"
}
```

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**
- `Retry-After: 3542` - –≤—Ä–µ–º—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö –¥–æ —Å–Ω—è—Ç–∏—è –ª–∏–º–∏—Ç–∞

## Frontend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

Frontend –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –ü–∞—Ä—Å–∏—Ç –æ—Ç–≤–µ—Ç —Å –æ—à–∏–±–∫–æ–π –ª–∏–º–∏—Ç–∞
2. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–∞–π–º–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á—ë—Ç–∞
3. –ë–ª–æ–∫–∏—Ä—É–µ—Ç –∫–Ω–æ–ø–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞
4. –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ

## –§–∞–π–ª—ã

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `backend/src/services/telegram_rate_limiter.py` | –°–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞–º–∏ |
| `backend/src/services/telegram_auth.py` | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç rate_limiter) |
| `backend/src/api/telegram_auth.py` | API endpoints |
| `frontend/src/components/auth/TelegramLogin.tsx` | UI —Å —Ç–∞–π–º–µ—Ä–æ–º |

## Redis –∫–ª—é—á–∏

| –ö–ª—é—á | –û–ø–∏—Å–∞–Ω–∏–µ | TTL |
|------|----------|-----|
| `tg_limit:{phone}` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ª–∏–º–∏—Ç–µ –¥–ª—è –Ω–æ–º–µ—Ä–∞ | wait_seconds + 60 |
| `tg_limit:stats:{type}` | –°—á—ë—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –ø–æ —Ç–∏–ø—É | 24 —á–∞—Å–∞ |
| `tg_limit:global:api_id` | –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç API_ID | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ |

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ù–µ —Å–ø–∞–º–∏—Ç—å –∫–æ–¥–∞–º–∏** - –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏ –¥–µ–ª–∞—Ç—å –ø–∞—É–∑—É 30-60 —Å–µ–∫
2. **–ù–µ –º–µ–Ω—è—Ç—å –Ω–æ–º–µ—Ä–∞** - Telegram –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—ã
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω API_ID** - –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
4. **–õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏** - –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è
