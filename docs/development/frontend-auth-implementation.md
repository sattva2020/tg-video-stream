# Реализация аутентификации на фронтенде

## Обзор

Фронтенд теперь имеет полный набор страниц для email/password аутентификации с поддержкой Google OAuth и сброса пароля.

### Реализованные страницы

#### 1. **LoginPage** (`frontend/src/pages/LoginPage.tsx`)

- Форма входа по email и паролю
- Валидация формы через React Hook Form + Zod
- Интеграция с Google OAuth
- Ссылки на страницы регистрации и сброса пароля
- Обработка ошибок с понятными сообщениями

#### 2. **RegisterPage** (`frontend/src/pages/RegisterPage.tsx`)

- Поля: email, пароль, опциональное ФИО
- Строгая валидация пароля (12+ символов, заглавные, строчные, цифры, спецсимволы)
- Валидация формы через React Hook Form + Zod
- Интеграция с Google OAuth
- Подсказки о требованиях к паролю
- Автоматический редирект на дашборд после успешной регистрации

#### 3. **PasswordResetPage** (`frontend/src/pages/PasswordResetPage.tsx`)

- Двухэтапный флоу:
  1. **Этап запроса**: введение email для запроса сброса пароля
  2. **Этап подтверждения**: введение токена и нового пароля
- Токен автоматически читается из параметра URL (`?token=...`)
- Строгая валидация пароля (как при регистрации)
- Обработка ошибок: email не найден, неверный токен
- Автоматический редирект на страницу входа после успешного сброса

### Интеграция API

Новые методы в `frontend/src/api/auth.ts`:

- `authApi.register(data: RegisterRequest)` — создание аккаунта
- `authApi.requestPasswordReset(data: PasswordResetRequestData)` — запрос письма со ссылкой сброса
- `authApi.confirmPasswordReset(data: PasswordResetConfirmData)` — подтверждение сброса с токеном

### Маршруты

Приложение использует React Router v6 со следующими маршрутами:

- `/login` — страница входа
- `/register` — страница регистрации
- `/password-reset` — флоу сброса пароля
- `/auth/callback` — обработчик OAuth callback
- `/dashboard` — защищённый дашборд (редирект на login при отсутствии токена)
- `/` — корневой путь (редирект на /dashboard)

### Политика валидации пароля

Все поля пароля требуют соблюдения следующей политики:

- Минимум 12 символов
- Как минимум одна заглавная буква (A-Z)
- Как минимум одна строчная буква (a-z)
- Как минимум одна цифра (0-9)
- Как минимум один спецсимвол (!@#$%^&*)

Это соответствует политике пароля на бэкенде, определённой в `backend/src/services/auth_service.py`.

### Role-Based Access Control (RBAC)

Система поддерживает разделение прав доступа на основе ролей: `user` и `admin`.

#### 1. **Типы пользователей** (`frontend/src/types/user.ts`)

- `UserRole.USER` ('user') — стандартная роль
- `UserRole.ADMIN` ('admin') — роль с расширенными правами

#### 2. **Контекст аутентификации** (`frontend/src/context/AuthContext.tsx`)

- Декодирует JWT токен для извлечения роли пользователя
- Предоставляет состояние `user` с полем `role` всему приложению
- Автоматически обновляет состояние при входе/выходе

#### 3. **Защита маршрутов** (`frontend/src/components/ProtectedRoute.tsx`)

- Поддерживает проп `allowedRoles` (массив разрешенных ролей)
- Если роль пользователя не в списке разрешенных, происходит редирект на главную страницу
- Пример использования:

  ```tsx
  <Route element={<ProtectedRoute allowedRoles={[UserRole.ADMIN]} />}>
    <Route path="/admin" element={<AdminPage />} />
  </Route>
  ```

#### 4. **UI Адаптация**

- Компоненты могут условно рендериться в зависимости от роли:

  ```tsx
  {user?.role === UserRole.ADMIN && <AdminButton />}
  ```

- `UserBadge` компонент отображает метку "Admin" для администраторов

### Использование

1. Запуск dev сервера:

```bash
npm run dev
```

1. Переход на `http://localhost:3000/register` для создания аккаунта

1. Использование `http://localhost:3000/login` для входа

1. Для сброса пароля:
   - Перейти на `/password-reset` и ввести email
   - Проверить почту на наличие ссылки для сброса (в dev режиме токен логируется в консоль)
   - Кликнуть на ссылку или скопировать токен
   - Ввести новый пароль

### Важные моменты

- JWT токен сохраняется в `localStorage` с ключом `token`
- Axios клиент автоматически включает токен во все запросы через перехватчик (interceptor)
- Все формы стилизованы Tailwind CSS и полностью отзывчивы
- Сообщения об ошибках понятны пользователю и содержат рекомендации

### Структура фронтенда

```text
frontend/src/
├── api/
│   ├── auth.ts          # Методы API аутентификации + Zod схемы
│   └── client.ts        # Axios клиент с перехватчиками
├── components/
│   ├── GoogleLoginButton.tsx
│   ├── LogoutButton.tsx
│   ├── ProtectedRoute.tsx
│   └── UserBadge.tsx
├── context/
│   └── AuthContext.tsx
├── types/
│   └── user.ts
├── pages/
│   ├── LoginPage.tsx
│   ├── RegisterPage.tsx
│   ├── PasswordResetPage.tsx
│   ├── AuthCallback.tsx
│   └── DashboardPage.tsx
├── lib/
│   └── utils.ts         # Вспомогательные функции
├── App.tsx              # Главный компонент с маршрутизацией
├── main.tsx             # Точка входа приложения
└── index.css            # Стили Tailwind
```
