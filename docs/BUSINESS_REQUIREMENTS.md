# Бизнес-требования (Business Requirements)

**Версия документа**: 1.0  
**Дата создания**: 24.11.2025  
**Статус**: Актуален

## 1. Видение продукта (Product Vision)

Проект представляет собой **автономную систему круглосуточного видеовещания (24/7 TV)** для групп в Telegram. 
Основная цель — обеспечить настаиваему по распмсанию трансляцию контента (видео из YouTube плейлистов, музыку их локальных файлов, m3u-плейлистов) в видеочат Telegram-группы, для каждой канала/группы возможен отдельное расписание, создавая эффект "телевизионного канала" для участников сообщества. Каждый пользователь может управлять своими каналами и группами, а также настраивать расписание трансляций.

Система разрабатывается как **Headless-решение** (работающее на сервере без графического интерфейса ОС) с управлением через **Веб-интерфейс (Dashboard)**.

## 2. Целевая аудитория

*   **Владельцы сообществ Telegram**: Желающие повысить вовлеченность аудитории через совместный просмотр контента.
*   **Контент-мейкеры**: Организующие "эфиры" и трансляции.
*   **Администраторы**: Технические специалисты, обслуживающие вещание.

## 3. Ролевая модель (User Roles)

Система реализует строгую модель управления доступом (RBAC) для обеспечения безопасности вещания.

### 3.1. Администратор (Admin)
*   **Права**: Полный доступ ко всем функциям системы.
*   **Возможности**:
    *   Управление пользователями (одобрение/отклонение регистраций, блокировка).
    *   Управление трансляцией (старт/стоп, перезапуск).
    *   Управление плейлистами (добавление/удаление контента).
    *   Просмотр технических метрик и логов.
    *   Настройка системных параметров.

### 3.2. Пользователь (User)
*   **Права**: Ограниченный доступ (View-Only).
*   **Возможности**:
    *   Просмотр статуса трансляции в Дашборде.
    *   Просмотр текущего плейлиста.
    *   *Ограничение*: Не может влиять на ход трансляции или изменять настройки.
*   **Назначение**: Роль по умолчанию для всех новых зарегистрированных пользователей.

### 3.3. Гость (Guest)
*   **Права**: Нет доступа к внутренним функциям.
*   **Возможности**:
    *   Регистрация (Email/Password или Google OAuth).
    *   Вход в систему.
    *   *Ограничение*: После регистрации попадает в статус **Pending** (Ожидание) и не имеет доступа к функционалу до одобрения Администратором.

## 4. Функциональные требования (Functional Requirements)

### 4.1. Подсистема вещания (Streaming Core)
*   **Мультиканальность**: Поддержка управления несколькими каналами/группами. Каждый пользователь может настроить трансляцию для своих ресурсов.
*   **Источник контента**: YouTube плейлисты (поддержка `yt-dlp` для извлечения прямых ссылок), локальные файлы, m3u-плейлисты.
*   **Трансляция**: Использование `PyTgCalls` для передачи аудио/видео потока в голосовой чат Telegram.
*   **Непрерывность**: Автоматический переход к следующему треку. Зацикливание плейлиста. Индивидуальные расписания для каждого канала.
*   **Качество**: Возможность настройки параметров FFmpeg (битрейт, пресеты) через конфигурацию (`FFMPEG_ARGS`).

### 4.2. Управление доступом и Безопасность (Auth & Security)
*   **Регистрация**: Поддержка классической регистрации (Email/Pass) и OAuth (Google).
*   **Привязка Telegram аккаунта (Telegram Login)**:
    *   Пользователь (Администратор) авторизуется в своем Telegram аккаунте через веб-интерфейс системы.
    *   **Flow**: Ввод номера телефона -> Получение кода в Telegram -> Ввод кода в UI (поддержка 2FA пароля) -> Генерация сессии.
    *   Сессия сохраняется в зашифрованном виде в базе данных и используется для управления трансляциями от имени пользователя.
*   **Workflow одобрения (User Approval)**:
    1.  Пользователь регистрируется -> Статус `Pending`.
    2.  Система уведомляет администраторов.
    3.  Администратор одобряет (`Approved`) или отклоняет (`Rejected`) заявку.
    4.  Только `Approved` пользователи получают JWT токен для доступа к API.
*   **Защита сессий**:
    *   Обработка истечения сессии Telegram (`SessionExpired`).
    *   Механизмы автоматической или ручной регенерации сессии без остановки сервиса (Degraded mode).

### 4.3. Пользовательский интерфейс (UI/UX)
*   **Дизайн**: Тематическое оформление ("ZenScene", "Чернила на пергаменте").
*   **Адаптивность**: Полная поддержка мобильных устройств.
*   **Темы**: Поддержка светлой и темной темы с синхронизацией выбора пользователя.
*   **Локализация**: Поддержка русского и английского языков (интерфейс и сообщения об ошибках).

## 5. Нефункциональные требования (Non-Functional Requirements)

### 5.1. Надежность (Reliability)
*   **Авто-восстановление**: Сервис должен автоматически перезапускаться при сбоях (использование `systemd` с политикой `Restart=always`).
*   **Обновление зависимостей**: Автоматическое обновление критических компонентов (например, `yt-dlp`) для поддержания работоспособности с внешними платформами.

### 5.2. Наблюдаемость (Observability)
*   **Метрики**: Экспорт бизнес-метрик (количество проигранных треков, аптайм) в формате Prometheus.
*   **Логирование**: Структурированные логи для диагностики проблем (особенно ошибок авторизации Telegram).

### 5.3. Безопасность инфраструктуры
*   **Хранение секретов**: Файлы конфигурации (`.env`) должны иметь строгие права доступа (600) и принадлежать системному пользователю.
*   **Изоляция**: Запуск процессов от непривилегированного пользователя.

## 6. Технический стек (Reference)

*   **Backend**: Python 3.12+, FastAPI, SQLAlchemy, Pyrogram, PyTgCalls.
*   **Frontend**: React, Vite, TailwindCSS.
*   **Database**: PostgreSQL (или SQLite для dev-окружения).
*   **Deployment**: Docker Compose (для зависимостей), Systemd (для управления процессами на хосте).
