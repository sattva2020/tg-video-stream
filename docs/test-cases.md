# Тест-кейсы авторизации и регистрации

Документ описывает базовые сценарии проверки email/password аутентификации в веб-админке. Позитивные кейсы выполняются с использованием тестового аккаунта `admin@sattva.com` и пароля `Zxy1234567`.

## Содержание
- [Назначение документа](#назначение-документа)
- [Предусловия и окружение](#предусловия-и-окружение)
- [Сценарии авторизации](#сценарии-авторизации)
- [Сценарии регистрации](#сценарии-регистрации)
- [Отчётность и артефакты](#отчётность-и-артефакты)

## Назначение документа
- Обеспечить единый список smoke-тестов для email/password аутентификации.
- Синхронизироваться с политикой паролей (12+ символов, смешанный регистр, цифры, спецсимволы).
- Служить основой для автоматизации Playwright/Lighthouse пайплайна.

## Предусловия и окружение
- Frontend доступен по `http://localhost:3000` (Vite dev server или preview).
- Backend API (`/api/auth/*`) запущен и подключён к тестовой БД.
- Тестовый пользователь `admin@sattva.com / Zxy1234567` создан вручную или миграцией.
- Очищены локальные storage/cookies браузера перед каждым кейсом.
- Для негативных проверок email `duplicate@sattva.com` уже зарегистрирован, `newuser@sattva.com` свободен.

## Сценарии авторизации

| ID | Тип | Цель | Шаги | Ожидаемый результат |
| --- | --- | --- | --- | --- |
| TC-AUTH-001 | Позитивный | Убедиться, что действующий пользователь входит в систему | 1. Открыть `/login`. 2. Ввести `admin@sattva.com` и `Zxy1234567`. 3. Нажать **Войти**. | Успешный ответ API 200, выдача JWT, редирект на `/dashboard`, в `localStorage.token` сохранён токен. |
| TC-AUTH-002 | Негативный | Проверить сообщение об ошибке при неправильном пароле | 1. Открыть `/login`. 2. Ввести `admin@sattva.com` и `Wrong123!`. 3. Отправить форму. | API возвращает 401, форма отображает текст об ошибке («Неверный логин или пароль»), токен не создаётся. |
| TC-AUTH-003 | Негативный | Проверить блокировку при превышении лимита попыток | 1. 5 раз подряд отправить неверный пароль для `admin@sattva.com`. 2. Повторить попытку с корректным паролем. | После N-й ошибки API возвращает 429/423 (согласно реализации), выводится сообщение о временной блокировке; попытка с правильным паролем до истечения таймера отклоняется. |
| TC-AUTH-004 | Негативный | Проверка валидации формы | 1. Оставить поля пустыми. 2. Нажать **Войти**. | Zod/React Hook Form подсвечивают обязательность полей, запрос на API не уходит. |
| TC-AUTH-005 | Негативный | Проверить поведение при отключённом backend | 1. Остановить backend. 2. Отправить форму с валидными данными. | Axios перехватывает сетевую ошибку, пользователь видит сервисное сообщение, повторные попытки не приводят к зацикливанию. |

## Сценарии регистрации

| ID | Тип | Цель | Шаги | Ожидаемый результат |
| --- | --- | --- | --- | --- |
| TC-REG-001 | Позитивный | Создание нового пользователя и автоматический вход | 1. Открыть `/register`. 2. Ввести email `newuser@sattva.com`, ФИО (опц.), пароль `Zxy1234567`. 3. Подтвердить форму. | API 201, создаётся аккаунт, полученный JWT сохраняется, выполняется редирект на `/dashboard`. |
| TC-REG-002 | Негативный | Попытка регистрации уже существующего email | 1. На `/register` указать `duplicate@sattva.com`. 2. Пароль `Zxy1234567`. | API возвращает 409, форма отображает сообщение «Email уже используется», запись не создаётся. |
| TC-REG-003 | Негативный | Проверка политики сложности пароля | 1. Заполнить форму кодом `Weakpass1`. | Клиентская и серверная валидация отклоняют форму с подсказками о требованиях к паролю, запрос на API не отправляется/возвращает 422. |
| TC-REG-004 | Негативный | Проверка обязательности email | 1. Оставить email пустым, заполнить остальные поля валидно. | Под полем email отображается ошибка обязательности, кнопка регистрации не активна/форма не отправляется. |
| TC-REG-005 | Негативный | Невалидный формат email | 1. Ввести `user@@sattva`. 2. Завершить форму. | Валидация фронтенда подсвечивает формат, API не вызывается. |
| TC-REG-006 | Технический | Проверка повторной отправки формы (двойной клик) | 1. Заполнить форму валидными данными. 2. Быстро нажать **Создать аккаунт** дважды. | Отправляется ровно один запрос (кнопка уходит в состояние loading), дублирование записи отсутствует. |

## Отчётность и артефакты
- Результаты ручного прогона фиксируются в `docs/REPORTS/test-run-<дата>.md`.
- Автотесты Playwright используют эти же сценарии через теги `@auth` и `@register`.
- Скриншоты/видео сохраняются в `.internal/playwright-mcp/<дата>/` и не публикуются в git.
