# Руководство по структуре проекта

## Цель документа
Данный документ описывает каноническую структуру репозитория `tg-video-stream` и правила размещения файлов. Его нужно прочитать перед любыми изменениями, чтобы сохранить единообразие и чистоту проекта.

## Базовые принципы
1. **Минимум в корне** – только критически важные файлы (README, package/pyproject, docker-compose, инструкции верхнего уровня). Всё остальное распределяется по тематическим каталогам.
2. **Чистая история** – временные, отладочные и машинные артефакты запрещены в корне и попадают в `.internal/` (добавлен в `.gitignore`).
3. **Ясная ответственность каталогов** – каждый раздел имеет чёткое назначение и не пересекается по функциям.
4. **Русскоязычная документация** – все текстовые инструкции в `docs/` и `ai-instructions/` пишутся на русском языке, код остаётся на английском.
5. **Тесты изолированы** – любые проверки, прототипы или отладочные скрипты оформляются через `tests/` или `tests/<subdir>` и не смешиваются с рабочим кодом.
6. **Синхронизация локально/удалённо** – изменения инфраструктуры на сервере немедленно отражаются в репозитории (шаблоны `.env`, конфиги, документация).

## Корневой уровень
| Каталог / файл          | Назначение |
|-------------------------|-----------|
| `backend/`              | FastAPI backend (Python 3.12, Alembic, Celery, тесты). |
| `frontend/`             | React/Vite UI, включая `public/`, `src/`, e2e тесты. |
| `streamer/`             | Служба вещания Telegram (Pyrogram/pytgcalls). |
| `scripts/`              | DevOps-скрипты (deploy, setup, tooling). |
| `docs/`                 | Пользовательская и техническая документация. |
| `specs/`                | Архитектурные/функциональные спецификации и планы итераций. |
| `ai-instructions/`      | Инструкции для AI-агентов, правила автоматизации. |
| `config/`               | Конфиги инфраструктуры (systemd, monitoring и т.п.). |
| `data/`                 | Непроизводственные статические данные/образцы. |
| `tests/`                | Дополнительные тестовые сценарии, smoke/fixture файлы. |
| `temp/`, `__pycache__/` | Временные каталоги, не попадают в релиз (по возможности удаляются). |
| `PROJECT_STRUCTURE_GUIDELINES.md` | Этот документ. |
| `STRUCTURE_QUICK_REFERENCE.md` | Краткая памятка по структуре. |

## Требования к директориям
- **backend/**: соблюдаем модульность (`src/api`, `src/models`, `src/services`, `src/lib`). Миграции лежат в `alembic/`, unit-тесты – в `tests/`. Никаких `.env`, дампов БД и IDE-файлов.
- **frontend/**: весь UI-код в `src/`, конфиги Vite/Tailwind рядом. Дев-серверные артефакты (`node_modules`, `dist`, отчёты) исключены из git.
- **streamer/**: код запуска/оркестрации потоков, конфигурации клиентов Telegram, без секретных `.session` – они генерируются во внутренние директории.
- **scripts/**: только исполняемые сценарии (bash, sh, ps1, js). Каждый скрипт снабжён кратким описанием и не содержит жёстко прописанных секретов.
- **docs/**: структурирована по подтемам (`architecture/`, `development/`, `security/` и т.д.) в соответствии с `docs/README.md`. Любые новые материалы создаются по шаблонам из `docs/templates/`.
- **specs/**: один каталог на фичу/инициативу с номером. Внутри план, анализ, прогресс.
- **ai-instructions/**: хранит правила генерации, деплоя, интеграции с AI-инструментами. Обновляется при изменении процессов.
- **config/**: отражает все конфигурации, присутствующие на серверах. После любых правок `systemd`, `nginx`, `.env` шаблонов – сразу обновляем соответствующие файлы.

## Временные и внутренние файлы
- Все логи, дампы, временные результаты тестов складываем в `.internal/` или `_dev/` и игнорируем через `.gitignore`.
- `tests/` используется для любых экспериментальных CLI/скриптовых проверок (создаём отдельный подкаталог, например `tests/smoke/`).
- Файлы вида `*_COMPLETE.md`, `test_*.sh`, `README_*.md` (кроме основного README) не должны лежать в корне – переносим в соответствующие разделы или удаляем.

## Документация и инструменты
1. Перед изменением документации запускаем `npm run docs:validate`.
2. После обновления – `npm run docs:report` + при необходимости `npm run docs:changelog`.
3. Все инструкции/отчёты содержат дату, автора и краткий контекст.
4. Комментарии в коде пишутся по необходимости, но на русском.

## Чеклист перед коммитом
- [ ] Нет временных файлов в корне (проверяем `git status`).
- [ ] Документация и спецификации обновлены при изменении требований.
- [ ] Шаблон `.env` синхронизирован с актуальной конфигурацией.
- [ ] Новые каталоги/файлы соответствуют таблице назначения.
- [ ] При добавлении тестов задействован раздел `tests/` и удалены промежуточные артефакты.

При обнаружении нарушений структуры фиксируем задачу в `OUTSTANDING_TASKS_REPORT.md` и устраняем как можно раньше.
